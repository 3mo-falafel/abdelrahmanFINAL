(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3147,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},52542,e=>{"use strict";let t=(0,e.i(16101).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],52542)},97435,e=>{"use strict";var t=e.i(34017),s=e.i(1894),a=e.i(15940),l=e.i(42306),r=e.i(52542),n=e.i(40984),i=e.i(55013),c=e.i(18489),d=e.i(13731),o=e.i(75280),x=e.i(40449),u=e.i(87837),m=e.i(78749),p=e.i(6757),h=e.i(82213),j=e.i(479),g=e.i(80367),f=e.i(18504),v=e.i(7356),N=e.i(50410),b=e.i(81150),S=e.i(29684);function y({order:e,open:a,onOpenChange:l,type:r}){let[n,i]=(0,s.useState)(!1),[c,d]=(0,s.useState)(""),[p,h]=(0,s.useState)(e.paid_amount.toString()),y=(0,b.useRouter)(),C="return"===r,_=C?"إرجاع الطلب":"استبدال الطلب",w=C?"سيتم إرجاع المنتجات للمخزون واسترداد المبلغ المدفوع":"سيتم إرجاع المنتجات للمخزون واستبدالها بمنتجات أخرى",I=async()=>{if(!c.trim())return void N.toast.error("الرجاء إدخال سبب الإرجاع/الاستبدال");let t=Number.parseFloat(p)||0;if(C&&t<0)return void N.toast.error("مبلغ الاسترداد غير صحيح");if(C&&t>e.paid_amount)return void N.toast.error("مبلغ الاسترداد لا يمكن أن يكون أكبر من المبلغ المدفوع");i(!0);let s=(0,v.createClient)();try{let{data:a}=await s.from("order_items").select("*").eq("order_id",e.id);if(a&&a.length>0){for(let e of a)if(e.product_id){let{data:t}=await s.from("products").select("quantity").eq("id",e.product_id).single();t&&await s.from("products").update({quantity:t.quantity+e.quantity,updated_at:new Date().toISOString()}).eq("id",e.product_id)}}let{error:r}=await s.from("orders").update({status:C?"مرتجع":"مستبدل",return_reason:c.trim(),returned_at:new Date().toISOString(),refund_amount:C?t:0,updated_at:new Date().toISOString()}).eq("id",e.id);if(r)throw r;N.toast.success(C?"تم إرجاع الطلب بنجاح":"تم تسجيل الاستبدال بنجاح"),l(!1),y.refresh()}catch(e){console.error("Error:",e),N.toast.error("حدث خطأ أثناء العملية")}finally{i(!1)}};return(0,t.jsx)(j.Dialog,{open:a,onOpenChange:l,children:(0,t.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,t.jsxs)(j.DialogHeader,{children:[(0,t.jsxs)(j.DialogTitle,{className:"flex items-center gap-2 text-xl",children:[C?(0,t.jsx)(o.RotateCcw,{className:"text-orange-500",size:24}):(0,t.jsx)(x.RefreshCw,{className:"text-purple-500",size:24}),_]}),(0,t.jsx)(j.DialogDescription,{children:w})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"bg-muted p-4 rounded-xl space-y-2",children:[(0,t.jsxs)("p",{className:"font-bold text-text",children:["طلب #",e.order_number]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"قيمة الطلب:"}),(0,t.jsx)("span",{className:"font-medium",children:(0,S.formatCurrency)(e.total_amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"المبلغ المدفوع:"}),(0,t.jsx)("span",{className:"font-medium text-success",children:(0,S.formatCurrency)(e.paid_amount)})]}),e.customer_name&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"العميل:"}),(0,t.jsx)("span",{className:"font-medium",children:e.customer_name})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(g.Label,{htmlFor:"reason",children:["سبب ",C?"الإرجاع":"الاستبدال"," ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)(f.Textarea,{id:"reason",value:c,onChange:e=>d(e.target.value),placeholder:`اكتب سبب ${C?"الإرجاع":"الاستبدال"}...`,className:"min-h-[80px]"})]}),C&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(g.Label,{htmlFor:"refund",children:"مبلغ الاسترداد"}),(0,t.jsx)(m.Input,{id:"refund",type:"number",step:"0.01",value:p,onChange:e=>h(e.target.value),placeholder:"0.00"}),(0,t.jsxs)("p",{className:"text-xs text-text-muted",children:["الحد الأقصى للاسترداد: ",(0,S.formatCurrency)(e.paid_amount)]})]}),(0,t.jsx)("div",{className:`p-3 rounded-lg ${C?"bg-orange-50 border border-orange-200":"bg-purple-50 border border-purple-200"}`,children:(0,t.jsx)("p",{className:`text-sm ${C?"text-orange-700":"text-purple-700"}`,children:"⚠️ سيتم إرجاع كميات المنتجات إلى المخزون تلقائياً"})})]}),(0,t.jsxs)(j.DialogFooter,{className:"gap-2",children:[(0,t.jsx)(u.Button,{variant:"outline",onClick:()=>l(!1),disabled:n,children:"إلغاء"}),(0,t.jsx)(u.Button,{onClick:I,disabled:n,className:C?"bg-orange-500 hover:bg-orange-600":"bg-purple-500 hover:bg-purple-600",children:n?"جاري المعالجة...":C?"تأكيد الإرجاع":"تأكيد الاستبدال"})]})]})})}function C({orders:e}){let[j,g]=(0,s.useState)(null),[f,C]=(0,s.useState)(null),[_,w]=(0,s.useState)("return"),[I,O]=(0,s.useState)(null),[D,z]=(0,s.useState)("all"),[k,q]=(0,s.useState)("all"),[T,R]=(0,s.useState)(""),B=(0,b.useRouter)(),V=e.filter(e=>{let t="all"===D||e.status===D,s="all"===k||e.payment_status===k,a=!T.trim()||e.order_number.toString().includes(T)||e.customer_name?.toLowerCase().includes(T.toLowerCase());return t&&s&&a}),F=async(e,t)=>{O(e);let s=(0,v.createClient)(),{error:a}=await s.from("orders").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);a?N.toast.error("حدث خطأ في تحديث حالة الطلب"):(N.toast.success("تم تحديث حالة الطلب"),B.refresh()),O(null)};return(0,t.jsxs)("div",{className:"bg-surface rounded-2xl shadow-sm border border-border",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-border space-y-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),(0,t.jsx)(m.Input,{placeholder:"ابحث برقم الطلب أو اسم العميل...",value:T,onChange:e=>R(e.target.value),className:"pr-10 pl-10 rounded-xl"}),T&&(0,t.jsx)("button",{onClick:()=>R(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:(0,t.jsx)(i.X,{size:18})})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(p.Select,{value:D,onValueChange:z,children:[(0,t.jsx)(p.SelectTrigger,{className:"flex-1 rounded-xl",children:(0,t.jsx)(p.SelectValue,{placeholder:"حالة الطلب"})}),(0,t.jsxs)(p.SelectContent,{children:[(0,t.jsx)(p.SelectItem,{value:"all",children:"جميع الحالات"}),(0,t.jsx)(p.SelectItem,{value:"جديد",children:"جديد"}),(0,t.jsx)(p.SelectItem,{value:"مكتمل",children:"مكتمل"}),(0,t.jsx)(p.SelectItem,{value:"ملغي",children:"ملغي"}),(0,t.jsx)(p.SelectItem,{value:"مرتجع",children:"مرتجع"}),(0,t.jsx)(p.SelectItem,{value:"مستبدل",children:"مستبدل"})]})]}),(0,t.jsxs)(p.Select,{value:k,onValueChange:q,children:[(0,t.jsx)(p.SelectTrigger,{className:"flex-1 rounded-xl",children:(0,t.jsx)(p.SelectValue,{placeholder:"حالة الدفع"})}),(0,t.jsxs)(p.SelectContent,{children:[(0,t.jsx)(p.SelectItem,{value:"all",children:"جميع حالات الدفع"}),(0,t.jsx)(p.SelectItem,{value:"مدفوع",children:"مدفوع"}),(0,t.jsx)(p.SelectItem,{value:"دين",children:"دين"}),(0,t.jsx)(p.SelectItem,{value:"دفع جزئي",children:"دفع جزئي"})]})]})]}),T&&(0,t.jsxs)("p",{className:"text-sm text-text-muted",children:["تم العثور على ",V.length," طلب"]})]}),0===V.length?(0,t.jsxs)("div",{className:"p-12 text-center",children:[(0,t.jsx)(a.ShoppingCart,{className:"mx-auto text-text-muted mb-4",size:48}),(0,t.jsx)("p",{className:"text-text-muted text-lg",children:"لا توجد طلبات بعد"})]}):(0,t.jsx)("div",{className:"divide-y divide-border",children:V.map(e=>{let s=I===e.id;return(0,t.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-text",children:["طلب #",e.order_number]}),(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(0,S.getOrderStatusColor)(e.status)}`,children:e.status}),(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(0,S.getPaymentStatusColor)(e.payment_status)}`,children:e.payment_status})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,t.jsxs)("p",{className:"text-text-muted flex items-center gap-1",children:[(0,t.jsx)(r.Clock,{size:16}),(0,S.formatDate)(e.created_at)]}),e.customer_name&&(0,t.jsxs)("p",{className:"text-text-muted flex items-center gap-1",children:[(0,t.jsx)(d.User,{size:16}),e.customer_name]}),"مدفوع"!==e.payment_status&&(0,t.jsxs)("p",{className:"text-danger flex items-center gap-1 font-medium",children:[(0,t.jsx)(c.CreditCard,{size:16}),"متبقي: ",(0,S.formatCurrency)(e.remaining_amount)]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-text-muted",children:"المبلغ"}),(0,t.jsx)("p",{className:"text-lg font-bold text-text",children:(0,S.formatCurrency)(e.total_amount)})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-text-muted",children:"التكلفة"}),(0,t.jsx)("p",{className:"text-lg font-bold text-text-muted",children:(0,S.formatCurrency)(e.total_cost)})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-text-muted",children:"الربح"}),(0,t.jsx)("p",{className:"text-lg font-bold text-success",children:(0,S.formatCurrency)(e.total_profit)})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:["مرتجع"!==e.status&&"مستبدل"!==e.status&&(0,t.jsxs)(p.Select,{value:e.status,onValueChange:t=>F(e.id,t),disabled:s,children:[(0,t.jsx)(p.SelectTrigger,{className:"w-32 rounded-xl",children:(0,t.jsx)(p.SelectValue,{})}),(0,t.jsxs)(p.SelectContent,{children:[(0,t.jsx)(p.SelectItem,{value:"جديد",children:"جديد"}),(0,t.jsx)(p.SelectItem,{value:"مكتمل",children:"مكتمل"}),(0,t.jsx)(p.SelectItem,{value:"ملغي",children:"ملغي"})]})]}),"مكتمل"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.Button,{variant:"outline",size:"sm",className:"rounded-xl gap-1 text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>{C(e),w("return")},children:[(0,t.jsx)(o.RotateCcw,{size:16}),"إرجاع"]}),(0,t.jsxs)(u.Button,{variant:"outline",size:"sm",className:"rounded-xl gap-1 text-purple-600 border-purple-300 hover:bg-purple-50",onClick:()=>{C(e),w("replace")},children:[(0,t.jsx)(x.RefreshCw,{size:16}),"استبدال"]})]}),(0,t.jsxs)(u.Button,{variant:"outline",className:"rounded-xl gap-2 bg-transparent",onClick:()=>g(e),children:[(0,t.jsx)(l.Eye,{size:18}),"التفاصيل"]})]})]})},e.id)})}),j&&(0,t.jsx)(h.OrderDetailsDialog,{order:j,open:!!j,onOpenChange:()=>g(null)}),f&&(0,t.jsx)(y,{order:f,open:!!f,onOpenChange:()=>C(null),type:_})]})}e.s(["OrdersList",()=>C],97435)}]);