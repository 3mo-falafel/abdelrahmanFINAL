(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,40984,e=>{"use strict";let t=(0,e.i(16101).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>t],40984)},78749,e=>{"use strict";var t=e.i(34017),r=e.i(16307);function s({className:e,type:s,...a}){return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...a})}e.s(["Input",()=>s])},15940,e=>{"use strict";let t=(0,e.i(16101).default)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);e.s(["ShoppingCart",()=>t],15940)},80367,e=>{"use strict";var t=e.i(34017),r=e.i(1894),s=e.i(52097),a=r.forwardRef((e,r)=>(0,t.jsx)(s.Primitive.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));a.displayName="Label";var i=e.i(16307);function l({className:e,...r}){return(0,t.jsx)(a,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...r})}e.s(["Label",()=>l],80367)},18489,e=>{"use strict";let t=(0,e.i(16101).default)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>t],18489)},94613,e=>{"use strict";let t=(0,e.i(16101).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],94613)},46242,85504,e=>{"use strict";var t=e.i(16101);let r=(0,t.default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);e.s(["Minus",()=>r],46242);let s=(0,t.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>s],85504)},1957,e=>{"use strict";var t=e.i(34017),r=e.i(1894),s=e.i(94613),a=e.i(46242),i=e.i(15940),l=e.i(85504),n=e.i(78681),o=e.i(16101);let c=(0,o.default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var d=e.i(13731),u=e.i(18489),x=e.i(40984),m=e.i(55013);let p=(0,o.default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var h=e.i(87837),b=e.i(78749),f=e.i(80367),g=e.i(7356),y=e.i(50410),j=e.i(81150),v=e.i(29684);function N(){let[e,o]=(0,r.useState)(!1),[N,w]=(0,r.useState)(""),[C,k]=(0,r.useState)([]),[_,q]=(0,r.useState)(""),[z,P]=(0,r.useState)(""),[S,M]=(0,r.useState)(""),[D,B]=(0,r.useState)(null),[F,T]=(0,r.useState)([]),I=(0,j.useRouter)();(0,r.useEffect)(()=>{(async()=>{let e=(0,g.createClient)(),{data:t}=await e.from("products").select("*").order("name",{ascending:!0});T(t||[])})()},[]);let L=F.filter(e=>(e.name.includes(N)||e.code.includes(N))&&e.quantity>0),A=(e,t)=>{k(C.map(r=>{if(r.product.id===e){let e=r.quantity+t;return e<=0?null:e>r.product.quantity?(y.toast.error("الكمية المطلوبة أكبر من المتوفر"),r):{...r,quantity:e}}return r}).filter(e=>null!==e))},R=(e,t)=>{if(t<=0){y.toast.error("السعر يجب أن يكون أكبر من صفر"),B(null);return}k(C.map(r=>r.product.id===e?{...r,customPrice:t}:r)),B(null),y.toast.success("تم تحديث السعر")},$=C.reduce((e,t)=>{let r=t.customPrice??t.product.selling_price,s=t.customPrice?(t.product.selling_price-t.customPrice)*t.quantity:0;return{amount:e.amount+r*t.quantity,cost:e.cost+t.product.purchase_price*t.quantity,profit:e.profit+(r-t.product.purchase_price)*t.quantity,totalDiscount:e.totalDiscount+s}},{amount:0,cost:0,profit:0,totalDiscount:0}),K=Number.parseFloat(z)||0,U=Number.parseFloat(S)||0,V={...$,amount:$.amount-K,profit:$.profit-K,totalDiscount:$.totalDiscount+K},E=async()=>{if(0===C.length)return void y.toast.error("السلة فارغة");if(K<0)return void y.toast.error("مبلغ الخصم لا يمكن أن يكون سالباً");if(K>$.amount)return void y.toast.error("مبلغ الخصم لا يمكن أن يكون أكبر من إجمالي السلة");if(U>0&&!_.trim())return void y.toast.error("الرجاء إدخال اسم العميل عند وجود دين");if(U>V.amount)return void y.toast.error("مبلغ الدين لا يمكن أن يكون أكبر من المبلغ الإجمالي بعد الخصم");let e=V.amount-U,t="مدفوع";U>0&&(t=e<=0?"دين":"دفع جزئي"),o(!0);let r=(0,g.createClient)(),{data:s,error:a}=await r.from("orders").insert({total_amount:V.amount,total_cost:V.cost,total_profit:V.profit,status:"مكتمل",customer_name:_.trim()||null,payment_status:t,paid_amount:e}).select().single();if(a||!s){y.toast.error("حدث خطأ في إنشاء الطلب"),o(!1);return}for(let e of C){let t=e.customPrice??e.product.selling_price,a=e.customPrice?e.product.selling_price-e.customPrice:0;await r.from("order_items").insert({order_id:s.id,product_id:e.product.id,product_name:e.product.name,quantity:e.quantity,unit_price:e.product.selling_price,unit_cost:e.product.purchase_price,total_price:t*e.quantity,total_cost:e.product.purchase_price*e.quantity,profit:(t-e.product.purchase_price)*e.quantity,custom_price:e.customPrice||null,discount_amount:a*e.quantity});let i=e.product.quantity-e.quantity;await r.from("products").update({quantity:i}).eq("id",e.product.id)}e>0&&await r.from("payment_history").insert({order_id:s.id,payment_amount:e,notes:"دفعة أولية عند إنشاء الطلب"}),y.toast.success("تم إنشاء الطلب بنجاح"),I.push("/orders")};return(0,t.jsx)("div",{className:"min-h-screen bg-background p-6",children:(0,t.jsxs)("div",{className:"max-w-[1800px] mx-auto",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(h.Button,{variant:"outline",onClick:()=>I.push("/orders"),className:"gap-2",children:[(0,t.jsx)(p,{size:20}),"رجوع"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-text",children:"إنشاء طلب جديد"}),(0,t.jsx)("p",{className:"text-text-muted mt-1",children:"اختر المنتجات وأضفها للسلة"})]})]})}),(0,t.jsxs)("div",{className:"flex gap-6 h-[calc(100vh-150px)]",children:[(0,t.jsxs)("div",{className:"w-[700px] flex flex-col bg-gradient-to-b from-muted to-background rounded-2xl p-6 border-2 border-border shadow-lg",children:[(0,t.jsxs)("h3",{className:"font-bold text-2xl text-text mb-6 flex items-center gap-3 pb-4 border-b-2 border-border",children:[(0,t.jsx)(i.ShoppingCart,{size:28,className:"text-primary"}),"سلة الطلب (",C.length,")"]}),(0,t.jsxs)("div",{className:"space-y-4 mb-6 p-4 bg-background rounded-xl border border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(f.Label,{htmlFor:"customerName",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,t.jsx)(d.User,{size:16}),"اسم العميل ",U>0&&(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)(b.Input,{id:"customerName",value:_,onChange:e=>q(e.target.value),placeholder:"اسم العميل (مطلوب عند وجود دين)",className:"rounded-lg h-12"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(f.Label,{htmlFor:"orderDiscount",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,t.jsx)(u.CreditCard,{size:16}),"خصم على الطلب"]}),(0,t.jsx)(b.Input,{id:"orderDiscount",type:"number",step:"0.01",min:"0",value:z,onChange:e=>P(e.target.value),placeholder:"0.00",className:"rounded-lg h-12"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(f.Label,{htmlFor:"debtAmount",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,t.jsx)(u.CreditCard,{size:16}),"مبلغ الدين"]}),(0,t.jsx)(b.Input,{id:"debtAmount",type:"number",step:"0.01",min:"0",value:S,onChange:e=>M(e.target.value),placeholder:"0.00",className:"rounded-lg h-12"})]})]}),(K>0||U>0)&&(0,t.jsxs)("div",{className:"text-sm space-y-1 p-3 bg-muted rounded-lg",children:[K>0&&(0,t.jsxs)("p",{className:"text-success",children:["الخصم: ",(0,v.formatCurrency)(K)]}),U>0&&(0,t.jsxs)("p",{className:"text-warning",children:["الدين: ",(0,v.formatCurrency)(U)," | سيدفع العميل: ",(0,v.formatCurrency)(V.amount-U)]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto space-y-3 mb-6 min-h-[200px]",children:0===C.length?(0,t.jsxs)("div",{className:"text-center text-text-muted py-16",children:[(0,t.jsx)(i.ShoppingCart,{size:64,className:"mx-auto mb-4 opacity-30"}),(0,t.jsx)("p",{className:"text-xl",children:"السلة فارغة"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"انقر على منتج لإضافته"})]}):C.map(e=>{let r=e.customPrice??e.product.selling_price,i=e.customPrice&&e.customPrice<e.product.selling_price;return(0,t.jsxs)("div",{className:"bg-surface p-4 rounded-xl border border-border",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("p",{className:"font-bold text-text",children:e.product.name}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.product.id,void k(C.filter(e=>e.product.id!==t))},className:"text-danger hover:text-danger/80 p-2",children:(0,t.jsx)(l.Trash2,{size:18})})]}),(0,t.jsx)("div",{className:"mb-3",children:D===e.product.id?(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(b.Input,{type:"number",step:"0.01",defaultValue:r,onKeyDown:t=>{"Enter"===t.key&&R(e.product.id,Number.parseFloat(t.currentTarget.value))},onBlur:t=>{let r=Number.parseFloat(t.target.value);r>0?R(e.product.id,r):B(null)},className:"h-9 rounded",autoFocus:!0})}):(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[i&&(0,t.jsx)("p",{className:"text-sm text-text-muted line-through",children:(0,v.formatCurrency)(e.product.selling_price)}),(0,t.jsx)("p",{className:`text-lg font-bold ${i?"text-success":"text-text"}`,children:(0,v.formatCurrency)(r)})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"icon",onClick:()=>B(e.product.id),children:(0,t.jsx)(c,{size:16})})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(h.Button,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-lg",onClick:()=>A(e.product.id,-1),children:(0,t.jsx)(a.Minus,{size:16})}),(0,t.jsx)("span",{className:"w-12 text-center font-bold text-text text-lg",children:e.quantity}),(0,t.jsx)(h.Button,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-lg",onClick:()=>A(e.product.id,1),children:(0,t.jsx)(s.Plus,{size:16})})]}),(0,t.jsx)("p",{className:"font-bold text-text text-lg",children:(0,v.formatCurrency)(r*e.quantity)})]})]},e.product.id)})}),(0,t.jsxs)("div",{className:"border-t-2 border-border pt-4 space-y-3",children:[V.totalDiscount>0&&(0,t.jsxs)("div",{className:"flex justify-between text-warning",children:[(0,t.jsx)("span",{children:"الخصم:"}),(0,t.jsxs)("span",{className:"font-bold",children:["-",(0,v.formatCurrency)(V.totalDiscount)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-text text-lg",children:[(0,t.jsx)("span",{children:"المبلغ الإجمالي:"}),(0,t.jsx)("span",{className:"font-bold",children:(0,v.formatCurrency)(V.amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-text-muted",children:[(0,t.jsx)("span",{children:"التكلفة:"}),(0,t.jsx)("span",{children:(0,v.formatCurrency)(V.cost)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-success font-bold text-lg",children:[(0,t.jsx)("span",{children:"الربح:"}),(0,t.jsx)("span",{children:(0,v.formatCurrency)(V.profit)})]}),V.profit>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm text-text-muted",children:[(0,t.jsx)("span",{children:"هامش الربح:"}),(0,t.jsxs)("span",{children:[(V.profit/V.amount*100).toFixed(1),"%"]})]})]}),(0,t.jsx)(h.Button,{onClick:E,disabled:e||0===C.length,className:"w-full mt-6 bg-primary hover:bg-primary-light text-white rounded-xl py-7 text-xl",children:e?"جاري الإنشاء...":"إنشاء الطلب"})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col bg-background rounded-2xl border-2 border-border p-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted",size:24}),(0,t.jsx)(b.Input,{placeholder:"ابحث عن منتج بالاسم أو الكود...",value:N,onChange:e=>w(e.target.value),className:"rounded-xl pr-14 pl-4 h-16 text-xl border-2 focus:border-primary font-medium"}),N&&(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>w(""),className:"absolute left-3 top-1/2 -translate-y-1/2",children:(0,t.jsx)(m.X,{size:20})})]}),(0,t.jsx)("div",{className:"flex items-center justify-between mt-4",children:(0,t.jsxs)("p",{className:"text-2xl font-bold text-text",children:[L.length," منتج متاح"]})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===L.length?(0,t.jsxs)("div",{className:"text-center text-text-muted py-20",children:[(0,t.jsx)(n.Package,{size:100,className:"mx-auto mb-6 opacity-20"}),(0,t.jsx)("p",{className:"text-3xl font-bold mb-3",children:"لا توجد منتجات"}),(0,t.jsx)("p",{className:"text-xl",children:N?`لا توجد نتائج لـ "${N}"`:"لا توجد منتجات متوفرة"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",children:L.map(e=>(0,t.jsxs)("div",{className:"group relative flex flex-col p-6 bg-surface rounded-2xl hover:bg-primary/5 cursor-pointer transition-all border-2 border-border hover:border-primary hover:shadow-2xl transform hover:scale-105",onClick:()=>{let t;(t=C.find(t=>t.product.id===e.id))?t.quantity<e.quantity?k(C.map(t=>t.product.id===e.id?{...t,quantity:t.quantity+1}:t)):y.toast.error("لا يمكن إضافة المزيد من هذا المنتج"):k([...C,{product:e,quantity:1}])},children:[(0,t.jsx)("div",{className:"absolute top-4 left-4 bg-primary text-white px-4 py-2 rounded-full text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:"اضغط للإضافة +"}),(0,t.jsx)("div",{className:"flex flex-col items-center mb-4",children:e.image_url?(0,t.jsx)("img",{src:e.image_url||"/placeholder.svg",alt:e.name,className:"w-32 h-32 rounded-2xl object-cover border-4 border-border group-hover:border-primary transition-colors"}):(0,t.jsx)("div",{className:"w-32 h-32 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center border-4 border-border group-hover:border-primary transition-colors",children:(0,t.jsx)(n.Package,{size:60,className:"text-primary"})})}),(0,t.jsxs)("div",{className:"flex-1 text-center",children:[(0,t.jsx)("h4",{className:"font-bold text-text text-xl mb-2 line-clamp-2",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-text-muted mb-3",children:["كود: ",e.code]}),(0,t.jsx)("div",{className:"flex items-center justify-center gap-2 mb-4",children:(0,t.jsx)("span",{className:`text-sm font-bold px-4 py-2 rounded-full ${e.quantity>e.low_stock_threshold?"bg-success/20 text-success border-2 border-success":e.quantity>0?"bg-warning/20 text-warning border-2 border-warning":"bg-danger/20 text-danger border-2 border-danger"}`,children:e.quantity>0?`${e.quantity} متوفر`:"نفد"})})]}),(0,t.jsxs)("div",{className:"text-center pt-4 border-t-2 border-border",children:[(0,t.jsx)("p",{className:"text-sm text-text-muted mb-2",children:"سعر البيع"}),(0,t.jsx)("p",{className:"font-bold text-primary text-3xl",children:(0,v.formatCurrency)(e.selling_price)})]})]},e.id))})})]})]})]})})}e.s(["default",()=>N],1957)}]);