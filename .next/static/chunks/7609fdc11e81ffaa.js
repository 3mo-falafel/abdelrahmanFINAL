(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3147,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},92516,e=>{"use strict";let t=(0,e.i(16101).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],92516)},15230,e=>{"use strict";var t=e.i(34017),s=e.i(29684);let r={primary:"bg-primary/10 text-primary",success:"bg-success/10 text-success",warning:"bg-warning/10 text-warning",danger:"bg-danger/10 text-danger"};function a({title:e,value:a,icon:l,isCurrency:n=!1,color:i}){return(0,t.jsxs)("div",{className:"bg-surface rounded-2xl p-6 shadow-sm border border-border",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("span",{className:"text-text-muted text-lg",children:e}),(0,t.jsx)("div",{className:`p-3 rounded-xl ${r[i]}`,children:(0,t.jsx)(l,{size:28})})]}),(0,t.jsx)("p",{className:"text-3xl font-bold text-text",children:n?(0,s.formatCurrency)(a):a.toLocaleString("ar-SA")})]})}e.s(["StatCard",()=>a])},49942,e=>{"use strict";let t=(0,e.i(16101).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],49942)},10123,e=>{"use strict";var t=e.i(34017),s=e.i(1894),r=e.i(29684),a=e.i(78749),l=e.i(87837),n=e.i(40984),i=e.i(55013),d=e.i(59269),o=e.i(92516),c=e.i(16101);let m=(0,c.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),x=(0,c.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var u=e.i(15230),h=e.i(49942),p=e.i(42306),b=e.i(18489),j=e.i(82213);function g({order:e,onPayment:a,paymentHistory:n}){let[i,d]=(0,s.useState)(!1),o=Number(e.paid_amount)/Number(e.total_amount)*100;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-background rounded-xl p-4 border border-border hover:border-primary transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-bold text-text",children:["طلب #",e.order_number]}),(0,t.jsxs)("p",{className:"text-xs text-text-muted flex items-center gap-1 mt-1",children:[(0,t.jsx)(h.Calendar,{size:12}),(0,r.formatDate)(e.created_at)]})]}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${(0,r.getPaymentStatusColor)(e.payment_status)}`,children:e.payment_status})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-text-muted mb-1",children:[(0,t.jsx)("span",{children:"الدفع"}),(0,t.jsxs)("span",{children:[o.toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"w-full h-2 bg-border rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-success to-primary transition-all duration-300",style:{width:`${o}%`}})})]}),(0,t.jsxs)("div",{className:"space-y-1 mb-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between text-text",children:[(0,t.jsx)("span",{children:"الإجمالي:"}),(0,t.jsx)("span",{className:"font-bold",children:(0,r.formatCurrency)(e.total_amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-success",children:[(0,t.jsx)("span",{children:"مدفوع:"}),(0,t.jsx)("span",{className:"font-bold",children:(0,r.formatCurrency)(e.paid_amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-danger",children:[(0,t.jsx)("span",{children:"متبقي:"}),(0,t.jsx)("span",{className:"font-bold",children:(0,r.formatCurrency)(e.remaining_amount)})]})]}),n.length>0&&(0,t.jsxs)("div",{className:"mb-3 p-2 bg-muted rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-text-muted mb-1",children:"آخر دفعة:"}),(0,t.jsxs)("p",{className:"text-xs text-text font-medium",children:[(0,r.formatCurrency)(n[0].payment_amount)," - ",(0,r.formatDate)(n[0].payment_date)]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(l.Button,{onClick:a,disabled:0>=Number(e.remaining_amount),className:"flex-1 bg-primary hover:bg-primary-light text-white rounded-lg",size:"sm",children:[(0,t.jsx)(b.CreditCard,{size:14,className:"ml-1"}),"إضافة دفعة"]}),(0,t.jsx)(l.Button,{onClick:()=>d(!0),variant:"outline",size:"sm",className:"rounded-lg",children:(0,t.jsx)(p.Eye,{size:14})})]})]}),i&&(0,t.jsx)(j.OrderDetailsDialog,{order:e,open:i,onOpenChange:d})]})}var f=e.i(479),y=e.i(80367),N=e.i(18504),v=e.i(7356),C=e.i(50410),_=e.i(81150);function w({order:e,open:n,onOpenChange:i}){let[o,c]=(0,s.useState)(!1),[m,x]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),p=(0,_.useRouter)(),b=async t=>{t.preventDefault();let s=Number.parseFloat(m);if(isNaN(s)||s<=0)return void C.toast.error("الرجاء إدخال مبلغ صحيح");if(s>Number(e.remaining_amount))return void C.toast.error("المبلغ المدخل أكبر من المبلغ المتبقي");c(!0);let r=(0,v.createClient)(),{error:a}=await r.from("payment_history").insert({order_id:e.id,payment_amount:s,notes:u.trim()||null});if(a){C.toast.error("حدث خطأ في إضافة الدفعة"),c(!1);return}let l=Number(e.paid_amount)+s,{error:n}=await r.from("orders").update({paid_amount:l,updated_at:new Date().toISOString()}).eq("id",e.id);if(n){C.toast.error("حدث خطأ في تحديث الطلب"),c(!1);return}C.toast.success("تم إضافة الدفعة بنجاح"),i(!1),x(""),h(""),p.refresh(),c(!1)},j=t=>{x((Number(e.remaining_amount)*t/100).toFixed(2))};return(0,t.jsx)(f.Dialog,{open:n,onOpenChange:i,children:(0,t.jsxs)(f.DialogContent,{className:"max-w-md",children:[(0,t.jsx)(f.DialogHeader,{children:(0,t.jsxs)(f.DialogTitle,{className:"text-2xl",children:["إضافة دفعة - طلب #",e.order_number]})}),(0,t.jsxs)("form",{onSubmit:b,className:"space-y-6 mt-4",children:[(0,t.jsxs)("div",{className:"bg-muted p-4 rounded-xl space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"العميل:"}),(0,t.jsx)("span",{className:"font-medium text-text",children:e.customer_name||"غير محدد"})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"الإجمالي:"}),(0,t.jsx)("span",{className:"font-bold text-text",children:(0,r.formatCurrency)(e.total_amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"مدفوع:"}),(0,t.jsx)("span",{className:"font-bold text-success",children:(0,r.formatCurrency)(e.paid_amount)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-text-muted",children:"المتبقي:"}),(0,t.jsx)("span",{className:"font-bold text-danger text-lg",children:(0,r.formatCurrency)(e.remaining_amount)})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(y.Label,{className:"text-sm text-text-muted mb-2 block",children:"مبالغ سريعة"}),(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>j(25),className:"rounded-lg",children:"25%"}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>j(50),className:"rounded-lg",children:"50%"}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>j(75),className:"rounded-lg",children:"75%"}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>x(e.remaining_amount.toString()),className:"rounded-lg",children:"الكل"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(y.Label,{htmlFor:"amount",className:"text-text mb-2 block",children:["مبلغ الدفعة ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Wallet,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),(0,t.jsx)(a.Input,{id:"amount",type:"number",step:"0.01",min:"0",max:e.remaining_amount,value:m,onChange:e=>x(e.target.value),placeholder:"0.00",className:"pr-10 text-lg rounded-xl",required:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(y.Label,{htmlFor:"notes",className:"text-text mb-2 block",children:"ملاحظات (اختياري)"}),(0,t.jsx)(N.Textarea,{id:"notes",value:u,onChange:e=>h(e.target.value),placeholder:"أضف ملاحظات حول الدفعة...",className:"rounded-xl resize-none",rows:3})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1 rounded-xl",disabled:o,children:"إلغاء"}),(0,t.jsx)(l.Button,{type:"submit",disabled:o,className:"flex-1 bg-primary hover:bg-primary-light rounded-xl",children:o?"جاري الإضافة...":"إضافة الدفعة"})]})]})]})})}function k({orders:e,paymentHistory:c}){let[h,p]=(0,s.useState)(""),[b,j]=(0,s.useState)(null),f=(0,s.useMemo)(()=>{let t=e.reduce((e,t)=>e+Number(t.remaining_amount||0),0);return{totalDebt:t,totalPaid:e.reduce((e,t)=>e+Number(t.paid_amount||0),0),uniqueCustomers:new Set(e.map(e=>e.customer_name).filter(Boolean)).size,ordersCount:e.length}},[e]),y=(0,s.useMemo)(()=>{if(!h.trim())return e;let t=h.trim().toLowerCase();return e.filter(e=>{let s=e.customer_name?.toLowerCase().includes(t),r=e.order_number.toString().includes(t);return s||r})},[h,e]),N=(0,s.useMemo)(()=>{let e=new Map;return y.forEach(t=>{let s=t.customer_name||"عميل غير محدد";e.has(s)||e.set(s,{customer:s,orders:[],totalDebt:0,totalPaid:0});let r=e.get(s);r.orders.push(t),r.totalDebt+=Number(t.remaining_amount||0),r.totalPaid+=Number(t.paid_amount||0)}),Array.from(e.values()).sort((e,t)=>t.totalDebt-e.totalDebt)},[y]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-text",children:"إدارة الديون"}),(0,t.jsx)("p",{className:"text-text-muted mt-2",children:"تتبع الديون والدفعات للعملاء"})]})}),(0,t.jsxs)("div",{className:"relative max-w-xl",children:[(0,t.jsx)(n.Search,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted",size:20}),(0,t.jsx)(a.Input,{type:"text",placeholder:"ابحث عن عميل أو رقم طلب...",value:h,onChange:e=>p(e.target.value),className:"pr-12 pl-12 py-6 text-lg rounded-xl border-2 border-border focus:border-primary bg-surface"}),h&&(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>p(""),className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:(0,t.jsx)(i.X,{size:20})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,t.jsx)(u.StatCard,{title:"إجمالي الديون",value:f.totalDebt,icon:x,isCurrency:!0,color:"danger"}),(0,t.jsx)(u.StatCard,{title:"إجمالي المدفوع",value:f.totalPaid,icon:d.Wallet,isCurrency:!0,color:"success"}),(0,t.jsx)(u.StatCard,{title:"عدد العملاء",value:f.uniqueCustomers,icon:m,color:"primary"}),(0,t.jsx)(u.StatCard,{title:"عدد الطلبات",value:f.ordersCount,icon:o.TrendingUp,color:"warning"})]}),0===N.length?(0,t.jsxs)("div",{className:"bg-surface rounded-2xl p-12 text-center border border-border",children:[(0,t.jsx)(x,{size:48,className:"mx-auto text-text-muted mb-4"}),(0,t.jsx)("p",{className:"text-text-muted text-lg",children:h?`لا توجد نتائج للبحث "${h}"`:"لا توجد ديون مسجلة"})]}):(0,t.jsx)("div",{className:"space-y-6",children:N.map(e=>(0,t.jsxs)("div",{className:"bg-surface rounded-2xl p-6 shadow-sm border border-border",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-text",children:e.customer}),(0,t.jsxs)("p",{className:"text-sm text-text-muted mt-1",children:[e.orders.length," طلب"]})]}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-sm text-text-muted",children:"الدين المتبقي"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-danger",children:(0,r.formatCurrency)(e.totalDebt)}),(0,t.jsxs)("p",{className:"text-xs text-success mt-1",children:["مدفوع: ",(0,r.formatCurrency)(e.totalPaid)]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.orders.map(e=>(0,t.jsx)(g,{order:e,onPayment:()=>j(e),paymentHistory:c.filter(t=>t.order_id===e.id)},e.id))})]},e.customer))}),b&&(0,t.jsx)(w,{order:b,open:!!b,onOpenChange:e=>!e&&j(null)})]})}e.s(["DebtsContent",()=>k],10123)}]);