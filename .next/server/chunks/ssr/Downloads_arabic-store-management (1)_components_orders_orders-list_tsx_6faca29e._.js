module.exports=[1986,a=>{"use strict";var b=a.i(42e3),c=a.i(41771),d=a.i(98241),e=a.i(86927),f=a.i(55052),g=a.i(96559),h=a.i(26982),i=a.i(18135),j=a.i(94752),k=a.i(97033),l=a.i(67669),m=a.i(83397),n=a.i(13586),o=a.i(99826),p=a.i(21610),q=a.i(30017),r=a.i(15351),s=a.i(37776),t=a.i(972),u=a.i(67815),v=a.i(90954),w=a.i(33332);function x({order:a,open:d,onOpenChange:e,type:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(""),[o,p]=(0,c.useState)(a.paid_amount.toString()),x=(0,v.useRouter)(),y="return"===f,z=y?"إرجاع الطلب":"استبدال الطلب",A=y?"سيتم إرجاع المنتجات للمخزون واسترداد المبلغ المدفوع":"سيتم إرجاع المنتجات للمخزون واستبدالها بمنتجات أخرى",B=async()=>{if(!i.trim())return void u.toast.error("الرجاء إدخال سبب الإرجاع/الاستبدال");let b=Number.parseFloat(o)||0;if(y&&b<0)return void u.toast.error("مبلغ الاسترداد غير صحيح");if(y&&b>a.paid_amount)return void u.toast.error("مبلغ الاسترداد لا يمكن أن يكون أكبر من المبلغ المدفوع");h(!0);let c=(0,t.createClient)();try{let{data:d}=await c.from("order_items").select("*").eq("order_id",a.id);if(d&&d.length>0){for(let a of d)if(a.product_id){let{data:b}=await c.from("products").select("quantity").eq("id",a.product_id).single();b&&await c.from("products").update({quantity:b.quantity+a.quantity,updated_at:new Date().toISOString()}).eq("id",a.product_id)}}let{error:f}=await c.from("orders").update({status:y?"مرتجع":"مستبدل",return_reason:i.trim(),returned_at:new Date().toISOString(),refund_amount:y?b:0,updated_at:new Date().toISOString()}).eq("id",a.id);if(f)throw f;u.toast.success(y?"تم إرجاع الطلب بنجاح":"تم تسجيل الاستبدال بنجاح"),e(!1),x.refresh()}catch(a){console.error("Error:",a),u.toast.error("حدث خطأ أثناء العملية")}finally{h(!1)}};return(0,b.jsx)(q.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsxs)(q.DialogTitle,{className:"flex items-center gap-2 text-xl",children:[y?(0,b.jsx)(k.RotateCcw,{className:"text-orange-500",size:24}):(0,b.jsx)(l.RefreshCw,{className:"text-purple-500",size:24}),z]}),(0,b.jsx)(q.DialogDescription,{children:A})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"bg-muted p-4 rounded-xl space-y-2",children:[(0,b.jsxs)("p",{className:"font-bold text-text",children:["طلب #",a.order_number]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"قيمة الطلب:"}),(0,b.jsx)("span",{className:"font-medium",children:(0,w.formatCurrency)(a.total_amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"المبلغ المدفوع:"}),(0,b.jsx)("span",{className:"font-medium text-success",children:(0,w.formatCurrency)(a.paid_amount)})]}),a.customer_name&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"العميل:"}),(0,b.jsx)("span",{className:"font-medium",children:a.customer_name})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(r.Label,{htmlFor:"reason",children:["سبب ",y?"الإرجاع":"الاستبدال"," ",(0,b.jsx)("span",{className:"text-danger",children:"*"})]}),(0,b.jsx)(s.Textarea,{id:"reason",value:i,onChange:a=>j(a.target.value),placeholder:`اكتب سبب ${y?"الإرجاع":"الاستبدال"}...`,className:"min-h-[80px]"})]}),y&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{htmlFor:"refund",children:"مبلغ الاسترداد"}),(0,b.jsx)(n.Input,{id:"refund",type:"number",step:"0.01",value:o,onChange:a=>p(a.target.value),placeholder:"0.00"}),(0,b.jsxs)("p",{className:"text-xs text-text-muted",children:["الحد الأقصى للاسترداد: ",(0,w.formatCurrency)(a.paid_amount)]})]}),(0,b.jsx)("div",{className:`p-3 rounded-lg ${y?"bg-orange-50 border border-orange-200":"bg-purple-50 border border-purple-200"}`,children:(0,b.jsx)("p",{className:`text-sm ${y?"text-orange-700":"text-purple-700"}`,children:"⚠️ سيتم إرجاع كميات المنتجات إلى المخزون تلقائياً"})})]}),(0,b.jsxs)(q.DialogFooter,{className:"gap-2",children:[(0,b.jsx)(m.Button,{variant:"outline",onClick:()=>e(!1),disabled:g,children:"إلغاء"}),(0,b.jsx)(m.Button,{onClick:B,disabled:g,className:y?"bg-orange-500 hover:bg-orange-600":"bg-purple-500 hover:bg-purple-600",children:g?"جاري المعالجة...":y?"تأكيد الإرجاع":"تأكيد الاستبدال"})]})]})})}function y({orders:a}){let[q,r]=(0,c.useState)(null),[s,y]=(0,c.useState)(null),[z,A]=(0,c.useState)("return"),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)("all"),[F,G]=(0,c.useState)("all"),[H,I]=(0,c.useState)(""),J=(0,v.useRouter)(),K=a.filter(a=>{let b="all"===D||a.status===D,c="all"===F||a.payment_status===F,d=!H.trim()||a.order_number.toString().includes(H)||a.customer_name?.toLowerCase().includes(H.toLowerCase());return b&&c&&d}),L=async(a,b)=>{C(a);let c=(0,t.createClient)(),{error:d}=await c.from("orders").update({status:b,updated_at:new Date().toISOString()}).eq("id",a);d?u.toast.error("حدث خطأ في تحديث حالة الطلب"):(u.toast.success("تم تحديث حالة الطلب"),J.refresh()),C(null)};return(0,b.jsxs)("div",{className:"bg-surface rounded-2xl shadow-sm border border-border",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),(0,b.jsx)(n.Input,{placeholder:"ابحث برقم الطلب أو اسم العميل...",value:H,onChange:a=>I(a.target.value),className:"pr-10 pl-10 rounded-xl"}),H&&(0,b.jsx)("button",{onClick:()=>I(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:(0,b.jsx)(h.X,{size:18})})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(o.Select,{value:D,onValueChange:E,children:[(0,b.jsx)(o.SelectTrigger,{className:"flex-1 rounded-xl",children:(0,b.jsx)(o.SelectValue,{placeholder:"حالة الطلب"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"جميع الحالات"}),(0,b.jsx)(o.SelectItem,{value:"جديد",children:"جديد"}),(0,b.jsx)(o.SelectItem,{value:"مكتمل",children:"مكتمل"}),(0,b.jsx)(o.SelectItem,{value:"ملغي",children:"ملغي"}),(0,b.jsx)(o.SelectItem,{value:"مرتجع",children:"مرتجع"}),(0,b.jsx)(o.SelectItem,{value:"مستبدل",children:"مستبدل"})]})]}),(0,b.jsxs)(o.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(o.SelectTrigger,{className:"flex-1 rounded-xl",children:(0,b.jsx)(o.SelectValue,{placeholder:"حالة الدفع"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"جميع حالات الدفع"}),(0,b.jsx)(o.SelectItem,{value:"مدفوع",children:"مدفوع"}),(0,b.jsx)(o.SelectItem,{value:"دين",children:"دين"}),(0,b.jsx)(o.SelectItem,{value:"دفع جزئي",children:"دفع جزئي"})]})]})]}),H&&(0,b.jsxs)("p",{className:"text-sm text-text-muted",children:["تم العثور على ",K.length," طلب"]})]}),0===K.length?(0,b.jsxs)("div",{className:"p-12 text-center",children:[(0,b.jsx)(d.ShoppingCart,{className:"mx-auto text-text-muted mb-4",size:48}),(0,b.jsx)("p",{className:"text-text-muted text-lg",children:"لا توجد طلبات بعد"})]}):(0,b.jsx)("div",{className:"divide-y divide-border",children:K.map(a=>{let c=B===a.id;return(0,b.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsxs)("h3",{className:"text-xl font-bold text-text",children:["طلب #",a.order_number]}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(0,w.getOrderStatusColor)(a.status)}`,children:a.status}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(0,w.getPaymentStatusColor)(a.payment_status)}`,children:a.payment_status})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,b.jsxs)("p",{className:"text-text-muted flex items-center gap-1",children:[(0,b.jsx)(f.Clock,{size:16}),(0,w.formatDate)(a.created_at)]}),a.customer_name&&(0,b.jsxs)("p",{className:"text-text-muted flex items-center gap-1",children:[(0,b.jsx)(j.User,{size:16}),a.customer_name]}),"مدفوع"!==a.payment_status&&(0,b.jsxs)("p",{className:"text-danger flex items-center gap-1 font-medium",children:[(0,b.jsx)(i.CreditCard,{size:16}),"متبقي: ",(0,w.formatCurrency)(a.remaining_amount)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-text-muted",children:"المبلغ"}),(0,b.jsx)("p",{className:"text-lg font-bold text-text",children:(0,w.formatCurrency)(a.total_amount)})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-text-muted",children:"التكلفة"}),(0,b.jsx)("p",{className:"text-lg font-bold text-text-muted",children:(0,w.formatCurrency)(a.total_cost)})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-text-muted",children:"الربح"}),(0,b.jsx)("p",{className:"text-lg font-bold text-success",children:(0,w.formatCurrency)(a.total_profit)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:["مرتجع"!==a.status&&"مستبدل"!==a.status&&(0,b.jsxs)(o.Select,{value:a.status,onValueChange:b=>L(a.id,b),disabled:c,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-32 rounded-xl",children:(0,b.jsx)(o.SelectValue,{})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"جديد",children:"جديد"}),(0,b.jsx)(o.SelectItem,{value:"مكتمل",children:"مكتمل"}),(0,b.jsx)(o.SelectItem,{value:"ملغي",children:"ملغي"})]})]}),"مكتمل"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",className:"rounded-xl gap-1 text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>{y(a),A("return")},children:[(0,b.jsx)(k.RotateCcw,{size:16}),"إرجاع"]}),(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",className:"rounded-xl gap-1 text-purple-600 border-purple-300 hover:bg-purple-50",onClick:()=>{y(a),A("replace")},children:[(0,b.jsx)(l.RefreshCw,{size:16}),"استبدال"]})]}),(0,b.jsxs)(m.Button,{variant:"outline",className:"rounded-xl gap-2 bg-transparent",onClick:()=>r(a),children:[(0,b.jsx)(e.Eye,{size:18}),"التفاصيل"]})]})]})},a.id)})}),q&&(0,b.jsx)(p.OrderDetailsDialog,{order:q,open:!!q,onOpenChange:()=>r(null)}),s&&(0,b.jsx)(x,{order:s,open:!!s,onOpenChange:()=>y(null),type:z})]})}a.s(["OrdersList",()=>y],1986)}];

//# sourceMappingURL=Downloads_arabic-store-management%20%281%29_components_orders_orders-list_tsx_6faca29e._.js.map