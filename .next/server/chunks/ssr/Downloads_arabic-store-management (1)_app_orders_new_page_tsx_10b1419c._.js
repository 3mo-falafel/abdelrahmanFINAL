module.exports=[60065,a=>{"use strict";var b=a.i(42e3),c=a.i(41771),d=a.i(23447),e=a.i(35609),f=a.i(98241),g=a.i(56283),h=a.i(75773),i=a.i(48137);let j=(0,i.default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var k=a.i(94752),l=a.i(18135),m=a.i(96559),n=a.i(26982);let o=(0,i.default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var p=a.i(83397),q=a.i(13586),r=a.i(15351),s=a.i(972),t=a.i(67815),u=a.i(90954),v=a.i(33332);function w(){let[a,i]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)([]),K=(0,u.useRouter)();(0,c.useEffect)(()=>{(async()=>{let a=(0,s.createClient)(),{data:b}=await a.from("products").select("*").order("name",{ascending:!0});J(b||[])})()},[]);let L=I.filter(a=>(a.name.includes(w)||a.code.includes(w))&&a.quantity>0),M=(a,b)=>{z(y.map(c=>{if(c.product.id===a){let a=c.quantity+b;return a<=0?null:a>c.product.quantity?(t.toast.error("الكمية المطلوبة أكبر من المتوفر"),c):{...c,quantity:a}}return c}).filter(a=>null!==a))},N=(a,b)=>{if(b<=0){t.toast.error("السعر يجب أن يكون أكبر من صفر"),H(null);return}z(y.map(c=>c.product.id===a?{...c,customPrice:b}:c)),H(null),t.toast.success("تم تحديث السعر")},O=y.reduce((a,b)=>{let c=b.customPrice??b.product.selling_price,d=b.customPrice?(b.product.selling_price-b.customPrice)*b.quantity:0;return{amount:a.amount+c*b.quantity,cost:a.cost+b.product.purchase_price*b.quantity,profit:a.profit+(c-b.product.purchase_price)*b.quantity,totalDiscount:a.totalDiscount+d}},{amount:0,cost:0,profit:0,totalDiscount:0}),P=Number.parseFloat(C)||0,Q=Number.parseFloat(E)||0,R={...O,amount:O.amount-P,profit:O.profit-P,totalDiscount:O.totalDiscount+P},S=async()=>{if(0===y.length)return void t.toast.error("السلة فارغة");if(P<0)return void t.toast.error("مبلغ الخصم لا يمكن أن يكون سالباً");if(P>O.amount)return void t.toast.error("مبلغ الخصم لا يمكن أن يكون أكبر من إجمالي السلة");if(Q>0&&!A.trim())return void t.toast.error("الرجاء إدخال اسم العميل عند وجود دين");if(Q>R.amount)return void t.toast.error("مبلغ الدين لا يمكن أن يكون أكبر من المبلغ الإجمالي بعد الخصم");let a=R.amount-Q,b="مدفوع";Q>0&&(b=a<=0?"دين":"دفع جزئي"),i(!0);let c=(0,s.createClient)(),{data:d,error:e}=await c.from("orders").insert({total_amount:R.amount,total_cost:R.cost,total_profit:R.profit,status:"مكتمل",customer_name:A.trim()||null,payment_status:b,paid_amount:a}).select().single();if(e||!d){t.toast.error("حدث خطأ في إنشاء الطلب"),i(!1);return}for(let a of y){let b=a.customPrice??a.product.selling_price,e=a.customPrice?a.product.selling_price-a.customPrice:0;await c.from("order_items").insert({order_id:d.id,product_id:a.product.id,product_name:a.product.name,quantity:a.quantity,unit_price:a.product.selling_price,unit_cost:a.product.purchase_price,total_price:b*a.quantity,total_cost:a.product.purchase_price*a.quantity,profit:(b-a.product.purchase_price)*a.quantity,custom_price:a.customPrice||null,discount_amount:e*a.quantity});let f=a.product.quantity-a.quantity;await c.from("products").update({quantity:f}).eq("id",a.product.id)}a>0&&await c.from("payment_history").insert({order_id:d.id,payment_amount:a,notes:"دفعة أولية عند إنشاء الطلب"}),t.toast.success("تم إنشاء الطلب بنجاح"),K.push("/orders")};return(0,b.jsx)("div",{className:"min-h-screen bg-background p-6",children:(0,b.jsxs)("div",{className:"max-w-[1800px] mx-auto",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)(p.Button,{variant:"outline",onClick:()=>K.push("/orders"),className:"gap-2",children:[(0,b.jsx)(o,{size:20}),"رجوع"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-text",children:"إنشاء طلب جديد"}),(0,b.jsx)("p",{className:"text-text-muted mt-1",children:"اختر المنتجات وأضفها للسلة"})]})]})}),(0,b.jsxs)("div",{className:"flex gap-6 h-[calc(100vh-150px)]",children:[(0,b.jsxs)("div",{className:"w-[700px] flex flex-col bg-gradient-to-b from-muted to-background rounded-2xl p-6 border-2 border-border shadow-lg",children:[(0,b.jsxs)("h3",{className:"font-bold text-2xl text-text mb-6 flex items-center gap-3 pb-4 border-b-2 border-border",children:[(0,b.jsx)(f.ShoppingCart,{size:28,className:"text-primary"}),"سلة الطلب (",y.length,")"]}),(0,b.jsxs)("div",{className:"space-y-4 mb-6 p-4 bg-background rounded-xl border border-border",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(r.Label,{htmlFor:"customerName",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,b.jsx)(k.User,{size:16}),"اسم العميل ",Q>0&&(0,b.jsx)("span",{className:"text-danger",children:"*"})]}),(0,b.jsx)(q.Input,{id:"customerName",value:A,onChange:a=>B(a.target.value),placeholder:"اسم العميل (مطلوب عند وجود دين)",className:"rounded-lg h-12"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(r.Label,{htmlFor:"orderDiscount",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,b.jsx)(l.CreditCard,{size:16}),"خصم على الطلب"]}),(0,b.jsx)(q.Input,{id:"orderDiscount",type:"number",step:"0.01",min:"0",value:C,onChange:a=>D(a.target.value),placeholder:"0.00",className:"rounded-lg h-12"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(r.Label,{htmlFor:"debtAmount",className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,b.jsx)(l.CreditCard,{size:16}),"مبلغ الدين"]}),(0,b.jsx)(q.Input,{id:"debtAmount",type:"number",step:"0.01",min:"0",value:E,onChange:a=>F(a.target.value),placeholder:"0.00",className:"rounded-lg h-12"})]})]}),(P>0||Q>0)&&(0,b.jsxs)("div",{className:"text-sm space-y-1 p-3 bg-muted rounded-lg",children:[P>0&&(0,b.jsxs)("p",{className:"text-success",children:["الخصم: ",(0,v.formatCurrency)(P)]}),Q>0&&(0,b.jsxs)("p",{className:"text-warning",children:["الدين: ",(0,v.formatCurrency)(Q)," | سيدفع العميل: ",(0,v.formatCurrency)(R.amount-Q)]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto space-y-3 mb-6 min-h-[200px]",children:0===y.length?(0,b.jsxs)("div",{className:"text-center text-text-muted py-16",children:[(0,b.jsx)(f.ShoppingCart,{size:64,className:"mx-auto mb-4 opacity-30"}),(0,b.jsx)("p",{className:"text-xl",children:"السلة فارغة"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"انقر على منتج لإضافته"})]}):y.map(a=>{let c=a.customPrice??a.product.selling_price,f=a.customPrice&&a.customPrice<a.product.selling_price;return(0,b.jsxs)("div",{className:"bg-surface p-4 rounded-xl border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("p",{className:"font-bold text-text",children:a.product.name}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.product.id,void z(y.filter(a=>a.product.id!==b))},className:"text-danger hover:text-danger/80 p-2",children:(0,b.jsx)(g.Trash2,{size:18})})]}),(0,b.jsx)("div",{className:"mb-3",children:G===a.product.id?(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(q.Input,{type:"number",step:"0.01",defaultValue:c,onKeyDown:b=>{"Enter"===b.key&&N(a.product.id,Number.parseFloat(b.currentTarget.value))},onBlur:b=>{let c=Number.parseFloat(b.target.value);c>0?N(a.product.id,c):H(null)},className:"h-9 rounded",autoFocus:!0})}):(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[f&&(0,b.jsx)("p",{className:"text-sm text-text-muted line-through",children:(0,v.formatCurrency)(a.product.selling_price)}),(0,b.jsx)("p",{className:`text-lg font-bold ${f?"text-success":"text-text"}`,children:(0,v.formatCurrency)(c)})]}),(0,b.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>H(a.product.id),children:(0,b.jsx)(j,{size:16})})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(p.Button,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-lg",onClick:()=>M(a.product.id,-1),children:(0,b.jsx)(e.Minus,{size:16})}),(0,b.jsx)("span",{className:"w-12 text-center font-bold text-text text-lg",children:a.quantity}),(0,b.jsx)(p.Button,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-lg",onClick:()=>M(a.product.id,1),children:(0,b.jsx)(d.Plus,{size:16})})]}),(0,b.jsx)("p",{className:"font-bold text-text text-lg",children:(0,v.formatCurrency)(c*a.quantity)})]})]},a.product.id)})}),(0,b.jsxs)("div",{className:"border-t-2 border-border pt-4 space-y-3",children:[R.totalDiscount>0&&(0,b.jsxs)("div",{className:"flex justify-between text-warning",children:[(0,b.jsx)("span",{children:"الخصم:"}),(0,b.jsxs)("span",{className:"font-bold",children:["-",(0,v.formatCurrency)(R.totalDiscount)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-text text-lg",children:[(0,b.jsx)("span",{children:"المبلغ الإجمالي:"}),(0,b.jsx)("span",{className:"font-bold",children:(0,v.formatCurrency)(R.amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-text-muted",children:[(0,b.jsx)("span",{children:"التكلفة:"}),(0,b.jsx)("span",{children:(0,v.formatCurrency)(R.cost)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-success font-bold text-lg",children:[(0,b.jsx)("span",{children:"الربح:"}),(0,b.jsx)("span",{children:(0,v.formatCurrency)(R.profit)})]}),R.profit>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm text-text-muted",children:[(0,b.jsx)("span",{children:"هامش الربح:"}),(0,b.jsxs)("span",{children:[(R.profit/R.amount*100).toFixed(1),"%"]})]})]}),(0,b.jsx)(p.Button,{onClick:S,disabled:a||0===y.length,className:"w-full mt-6 bg-primary hover:bg-primary-light text-white rounded-xl py-7 text-xl",children:a?"جاري الإنشاء...":"إنشاء الطلب"})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col bg-background rounded-2xl border-2 border-border p-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Search,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted",size:24}),(0,b.jsx)(q.Input,{placeholder:"ابحث عن منتج بالاسم أو الكود...",value:w,onChange:a=>x(a.target.value),className:"rounded-xl pr-14 pl-4 h-16 text-xl border-2 focus:border-primary font-medium"}),w&&(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>x(""),className:"absolute left-3 top-1/2 -translate-y-1/2",children:(0,b.jsx)(n.X,{size:20})})]}),(0,b.jsx)("div",{className:"flex items-center justify-between mt-4",children:(0,b.jsxs)("p",{className:"text-2xl font-bold text-text",children:[L.length," منتج متاح"]})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===L.length?(0,b.jsxs)("div",{className:"text-center text-text-muted py-20",children:[(0,b.jsx)(h.Package,{size:100,className:"mx-auto mb-6 opacity-20"}),(0,b.jsx)("p",{className:"text-3xl font-bold mb-3",children:"لا توجد منتجات"}),(0,b.jsx)("p",{className:"text-xl",children:w?`لا توجد نتائج لـ "${w}"`:"لا توجد منتجات متوفرة"})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",children:L.map(a=>(0,b.jsxs)("div",{className:"group relative flex flex-col p-6 bg-surface rounded-2xl hover:bg-primary/5 cursor-pointer transition-all border-2 border-border hover:border-primary hover:shadow-2xl transform hover:scale-105",onClick:()=>{let b;(b=y.find(b=>b.product.id===a.id))?b.quantity<a.quantity?z(y.map(b=>b.product.id===a.id?{...b,quantity:b.quantity+1}:b)):t.toast.error("لا يمكن إضافة المزيد من هذا المنتج"):z([...y,{product:a,quantity:1}])},children:[(0,b.jsx)("div",{className:"absolute top-4 left-4 bg-primary text-white px-4 py-2 rounded-full text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:"اضغط للإضافة +"}),(0,b.jsx)("div",{className:"flex flex-col items-center mb-4",children:a.image_url?(0,b.jsx)("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-32 h-32 rounded-2xl object-cover border-4 border-border group-hover:border-primary transition-colors"}):(0,b.jsx)("div",{className:"w-32 h-32 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center border-4 border-border group-hover:border-primary transition-colors",children:(0,b.jsx)(h.Package,{size:60,className:"text-primary"})})}),(0,b.jsxs)("div",{className:"flex-1 text-center",children:[(0,b.jsx)("h4",{className:"font-bold text-text text-xl mb-2 line-clamp-2",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-text-muted mb-3",children:["كود: ",a.code]}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-2 mb-4",children:(0,b.jsx)("span",{className:`text-sm font-bold px-4 py-2 rounded-full ${a.quantity>a.low_stock_threshold?"bg-success/20 text-success border-2 border-success":a.quantity>0?"bg-warning/20 text-warning border-2 border-warning":"bg-danger/20 text-danger border-2 border-danger"}`,children:a.quantity>0?`${a.quantity} متوفر`:"نفد"})})]}),(0,b.jsxs)("div",{className:"text-center pt-4 border-t-2 border-border",children:[(0,b.jsx)("p",{className:"text-sm text-text-muted mb-2",children:"سعر البيع"}),(0,b.jsx)("p",{className:"font-bold text-primary text-3xl",children:(0,v.formatCurrency)(a.selling_price)})]})]},a.id))})})]})]})]})})}a.s(["default",()=>w],60065)}];

//# sourceMappingURL=Downloads_arabic-store-management%20%281%29_app_orders_new_page_tsx_10b1419c._.js.map