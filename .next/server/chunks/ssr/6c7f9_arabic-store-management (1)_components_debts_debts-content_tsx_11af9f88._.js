module.exports=[3470,a=>{"use strict";var b=a.i(42e3),c=a.i(41771),d=a.i(33332),e=a.i(13586),f=a.i(83397),g=a.i(96559),h=a.i(26982),i=a.i(46118),j=a.i(48220),k=a.i(48137);let l=(0,k.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),m=(0,k.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var n=a.i(67711),o=a.i(13855),p=a.i(86927),q=a.i(18135),r=a.i(21610);function s({order:a,onPayment:e,paymentHistory:g}){let[h,i]=(0,c.useState)(!1),j=Number(a.paid_amount)/Number(a.total_amount)*100;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-background rounded-xl p-4 border border-border hover:border-primary transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-bold text-text",children:["طلب #",a.order_number]}),(0,b.jsxs)("p",{className:"text-xs text-text-muted flex items-center gap-1 mt-1",children:[(0,b.jsx)(o.Calendar,{size:12}),(0,d.formatDate)(a.created_at)]})]}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${(0,d.getPaymentStatusColor)(a.payment_status)}`,children:a.payment_status})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-text-muted mb-1",children:[(0,b.jsx)("span",{children:"الدفع"}),(0,b.jsxs)("span",{children:[j.toFixed(0),"%"]})]}),(0,b.jsx)("div",{className:"w-full h-2 bg-border rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-success to-primary transition-all duration-300",style:{width:`${j}%`}})})]}),(0,b.jsxs)("div",{className:"space-y-1 mb-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between text-text",children:[(0,b.jsx)("span",{children:"الإجمالي:"}),(0,b.jsx)("span",{className:"font-bold",children:(0,d.formatCurrency)(a.total_amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-success",children:[(0,b.jsx)("span",{children:"مدفوع:"}),(0,b.jsx)("span",{className:"font-bold",children:(0,d.formatCurrency)(a.paid_amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-danger",children:[(0,b.jsx)("span",{children:"متبقي:"}),(0,b.jsx)("span",{className:"font-bold",children:(0,d.formatCurrency)(a.remaining_amount)})]})]}),g.length>0&&(0,b.jsxs)("div",{className:"mb-3 p-2 bg-muted rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-text-muted mb-1",children:"آخر دفعة:"}),(0,b.jsxs)("p",{className:"text-xs text-text font-medium",children:[(0,d.formatCurrency)(g[0].payment_amount)," - ",(0,d.formatDate)(g[0].payment_date)]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{onClick:e,disabled:0>=Number(a.remaining_amount),className:"flex-1 bg-primary hover:bg-primary-light text-white rounded-lg",size:"sm",children:[(0,b.jsx)(q.CreditCard,{size:14,className:"ml-1"}),"إضافة دفعة"]}),(0,b.jsx)(f.Button,{onClick:()=>i(!0),variant:"outline",size:"sm",className:"rounded-lg",children:(0,b.jsx)(p.Eye,{size:14})})]})]}),h&&(0,b.jsx)(r.OrderDetailsDialog,{order:a,open:h,onOpenChange:i})]})}var t=a.i(30017),u=a.i(15351),v=a.i(37776),w=a.i(972),x=a.i(67815),y=a.i(90954);function z({order:a,open:g,onOpenChange:h}){let[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),p=(0,y.useRouter)(),q=async b=>{b.preventDefault();let c=Number.parseFloat(l);if(isNaN(c)||c<=0)return void x.toast.error("الرجاء إدخال مبلغ صحيح");if(c>Number(a.remaining_amount))return void x.toast.error("المبلغ المدخل أكبر من المبلغ المتبقي");k(!0);let d=(0,w.createClient)(),{error:e}=await d.from("payment_history").insert({order_id:a.id,payment_amount:c,notes:n.trim()||null});if(e){x.toast.error("حدث خطأ في إضافة الدفعة"),k(!1);return}let f=Number(a.paid_amount)+c,{error:g}=await d.from("orders").update({paid_amount:f,updated_at:new Date().toISOString()}).eq("id",a.id);if(g){x.toast.error("حدث خطأ في تحديث الطلب"),k(!1);return}x.toast.success("تم إضافة الدفعة بنجاح"),h(!1),m(""),o(""),p.refresh(),k(!1)},r=b=>{m((Number(a.remaining_amount)*b/100).toFixed(2))};return(0,b.jsx)(t.Dialog,{open:g,onOpenChange:h,children:(0,b.jsxs)(t.DialogContent,{className:"max-w-md",children:[(0,b.jsx)(t.DialogHeader,{children:(0,b.jsxs)(t.DialogTitle,{className:"text-2xl",children:["إضافة دفعة - طلب #",a.order_number]})}),(0,b.jsxs)("form",{onSubmit:q,className:"space-y-6 mt-4",children:[(0,b.jsxs)("div",{className:"bg-muted p-4 rounded-xl space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"العميل:"}),(0,b.jsx)("span",{className:"font-medium text-text",children:a.customer_name||"غير محدد"})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"الإجمالي:"}),(0,b.jsx)("span",{className:"font-bold text-text",children:(0,d.formatCurrency)(a.total_amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"مدفوع:"}),(0,b.jsx)("span",{className:"font-bold text-success",children:(0,d.formatCurrency)(a.paid_amount)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-text-muted",children:"المتبقي:"}),(0,b.jsx)("span",{className:"font-bold text-danger text-lg",children:(0,d.formatCurrency)(a.remaining_amount)})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(u.Label,{className:"text-sm text-text-muted mb-2 block",children:"مبالغ سريعة"}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>r(25),className:"rounded-lg",children:"25%"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>r(50),className:"rounded-lg",children:"50%"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>r(75),className:"rounded-lg",children:"75%"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>m(a.remaining_amount.toString()),className:"rounded-lg",children:"الكل"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(u.Label,{htmlFor:"amount",className:"text-text mb-2 block",children:["مبلغ الدفعة ",(0,b.jsx)("span",{className:"text-danger",children:"*"})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.Wallet,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),(0,b.jsx)(e.Input,{id:"amount",type:"number",step:"0.01",min:"0",max:a.remaining_amount,value:l,onChange:a=>m(a.target.value),placeholder:"0.00",className:"pr-10 text-lg rounded-xl",required:!0})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(u.Label,{htmlFor:"notes",className:"text-text mb-2 block",children:"ملاحظات (اختياري)"}),(0,b.jsx)(v.Textarea,{id:"notes",value:n,onChange:a=>o(a.target.value),placeholder:"أضف ملاحظات حول الدفعة...",className:"rounded-xl resize-none",rows:3})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>h(!1),className:"flex-1 rounded-xl",disabled:j,children:"إلغاء"}),(0,b.jsx)(f.Button,{type:"submit",disabled:j,className:"flex-1 bg-primary hover:bg-primary-light rounded-xl",children:j?"جاري الإضافة...":"إضافة الدفعة"})]})]})]})})}function A({orders:a,paymentHistory:k}){let[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(null),t=(0,c.useMemo)(()=>{let b=a.reduce((a,b)=>a+Number(b.remaining_amount||0),0);return{totalDebt:b,totalPaid:a.reduce((a,b)=>a+Number(b.paid_amount||0),0),uniqueCustomers:new Set(a.map(a=>a.customer_name).filter(Boolean)).size,ordersCount:a.length}},[a]),u=(0,c.useMemo)(()=>{if(!o.trim())return a;let b=o.trim().toLowerCase();return a.filter(a=>{let c=a.customer_name?.toLowerCase().includes(b),d=a.order_number.toString().includes(b);return c||d})},[o,a]),v=(0,c.useMemo)(()=>{let a=new Map;return u.forEach(b=>{let c=b.customer_name||"عميل غير محدد";a.has(c)||a.set(c,{customer:c,orders:[],totalDebt:0,totalPaid:0});let d=a.get(c);d.orders.push(b),d.totalDebt+=Number(b.remaining_amount||0),d.totalPaid+=Number(b.paid_amount||0)}),Array.from(a.values()).sort((a,b)=>b.totalDebt-a.totalDebt)},[u]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-text",children:"إدارة الديون"}),(0,b.jsx)("p",{className:"text-text-muted mt-2",children:"تتبع الديون والدفعات للعملاء"})]})}),(0,b.jsxs)("div",{className:"relative max-w-xl",children:[(0,b.jsx)(g.Search,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted",size:20}),(0,b.jsx)(e.Input,{type:"text",placeholder:"ابحث عن عميل أو رقم طلب...",value:o,onChange:a=>p(a.target.value),className:"pr-12 pl-12 py-6 text-lg rounded-xl border-2 border-border focus:border-primary bg-surface"}),o&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>p(""),className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:(0,b.jsx)(h.X,{size:20})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,b.jsx)(n.StatCard,{title:"إجمالي الديون",value:t.totalDebt,icon:m,isCurrency:!0,color:"danger"}),(0,b.jsx)(n.StatCard,{title:"إجمالي المدفوع",value:t.totalPaid,icon:i.Wallet,isCurrency:!0,color:"success"}),(0,b.jsx)(n.StatCard,{title:"عدد العملاء",value:t.uniqueCustomers,icon:l,color:"primary"}),(0,b.jsx)(n.StatCard,{title:"عدد الطلبات",value:t.ordersCount,icon:j.TrendingUp,color:"warning"})]}),0===v.length?(0,b.jsxs)("div",{className:"bg-surface rounded-2xl p-12 text-center border border-border",children:[(0,b.jsx)(m,{size:48,className:"mx-auto text-text-muted mb-4"}),(0,b.jsx)("p",{className:"text-text-muted text-lg",children:o?`لا توجد نتائج للبحث "${o}"`:"لا توجد ديون مسجلة"})]}):(0,b.jsx)("div",{className:"space-y-6",children:v.map(a=>(0,b.jsxs)("div",{className:"bg-surface rounded-2xl p-6 shadow-sm border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-border",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-bold text-text",children:a.customer}),(0,b.jsxs)("p",{className:"text-sm text-text-muted mt-1",children:[a.orders.length," طلب"]})]}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"text-sm text-text-muted",children:"الدين المتبقي"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-danger",children:(0,d.formatCurrency)(a.totalDebt)}),(0,b.jsxs)("p",{className:"text-xs text-success mt-1",children:["مدفوع: ",(0,d.formatCurrency)(a.totalPaid)]})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.orders.map(a=>(0,b.jsx)(s,{order:a,onPayment:()=>r(a),paymentHistory:k.filter(b=>b.order_id===a.id)},a.id))})]},a.customer))}),q&&(0,b.jsx)(z,{order:q,open:!!q,onOpenChange:a=>!a&&r(null)})]})}a.s(["DebtsContent",()=>A],3470)}];

//# sourceMappingURL=6c7f9_arabic-store-management%20%281%29_components_debts_debts-content_tsx_11af9f88._.js.map